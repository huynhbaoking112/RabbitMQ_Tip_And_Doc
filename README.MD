1) Cháº¿ Ä‘á»™ ngang hÃ ng

    +) Tin nháº¯n cÃ³ thá»ƒ Ä‘Æ°á»£c nháº­n tá»« nhiá»u khÃ¡ch hÃ ng 

    +) Nhiá»u Producer cÃ³ thá»ƒ gá»­i thÆ° vÃ o 1 hÃ ng Ä‘á»£i

2) Má»™t há»‡ thá»‘ng RabbiMQ cÃ³ thá»ƒ nhÆ° hÃ¬nh sau  

    ![alt](fileImage/map.jpg)

3) Code 

    ![alt](fileImage/code.jpg)

3) Giáº£i thÃ­ch

    - Flow hoáº¡t Ä‘á»™ng:

        +) Producer trÆ°á»›c khi nháº¯n event thÃ¬ táº¡o 1 channel ( Ká»ƒ cáº£ consumer cÅ©ng váº­y vÃ¬ táº¥t cáº£ cÃ¡c giao tiáº¿p sáº½ qua channel )

        +) Sau khi táº¡o channel thÃ¬ event sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n ExChange 
             
             *) NÃ³i sÆ¡ qua exchange: Exchange bao gá»“m 4 loáº¡i:

                            Topic: Sá»­ dá»¥ng cÃ¡c topic trong cÃ¡c event producer gá»­i Ä‘i vd order.one thÃ¬ cÃ¡c queue káº¿t ná»‘i vá»›i exchange order.* cháº³ng háº¡n sáº½ nháº­n Ä‘Æ°á»£c

                            Direction: Sá»­ dá»¥ng cÃ¡c Routing_key Ä‘á»ƒ xÃ¡c minh cáº§n gá»­i event Ä‘áº¿n queue nÃ o ( routing key trong khi producer gá»­i Ä‘áº¿n exchange vÃ  routing key khi exchange binding vá»›i queue ) 

                            fanout: Gá»­i event cho táº¥t cáº£ cÃ¡c queue binding

                            header: Set header cho event vÃ  check xem header queue nÃ o trÃ¹ng
    

        +) Sau Ä‘Ã³ exchange sáº½ gá»­i Ä‘áº¿n queue theo Ä‘Ãºng lá»™ trÃ¬nh 

        +) Queue gá»­i Ä‘áº¿n channel cá»§a consumer xá»­ lÃ­

    - Má»™t sá»‘ lÆ°u Ã½:
    
        Trong consumer buá»™c pháº£i cÃ³ má»™t cÆ¡ cháº¿ xá»­ lÃ­ message láº¡ trÃ¡nh viá»‡c khÃ´ng thá»ƒ xá»­ lÃ­ message láº¡ dáº«n Ä‘áº¿n Ä‘áº§y queue

        Set nhiá»u consumer cÃ¹ng loáº¡i cÃ¹ng xá»­ lÃ­ má»™t queue Ä‘á»ƒ giáº£m táº£i cho consumer trÃ¡nh kháº£ nÄƒng lá»—i

        noAck: Náº¿u set lÃ  false thÃ¬ cÃ¡c message sáº½ khÃ´ng Ä‘Æ°á»£c xÃ¡c nháº­n lÃ  Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh vÃ  báº­t cháº¿ Ä‘á»™ kiá»ƒm soÃ¡t tin nháº¯n náº¿u tin nháº¯n hoÃ n thÃ nh thÃ¬ pháº£i set  // Acknowledge message
        channel.ack(msg);

        má»™t queue chá»‰ gá»­i message Ä‘áº¿n má»™t consumer Ä‘á»ƒ xá»­ lÃ­ náº¿u cÃ³ nhiá»u consumer thÃ¬ queue sáº½ phÃ¢n phÃ¡t giáº£m táº£i cho consumer( Váº­y nÃªn Ä‘á»ƒ scale há»‡ thá»‘ng chá»— nÃ y ta cÃ³ thá»ƒ triá»ƒn khai nhiá»u consumer )

        duration - persisten: Khi crack RabbitMQ váº«n khÃ´ng máº¥t message ( KhÃ´ng hoÃ n toÃ n Ä‘áº£m báº£o vÃ¬ máº·c dÃ¹ nÃ³ yÃªu cáº§u RabbitMQ lÆ°u tin nháº¯n vÃ o Ä‘Ä©a nhÆ°ng váº«n cÃ³ má»™t khoáº£ng thá»i gian ngáº¯n khi RabbitMQ Ä‘Ã£ cháº¥p nháº­n tin nháº¯n vÃ  chÆ°a lÆ°u nÃ³. NgoÃ i ra nÃ³ khÃ´ng thá»±c hiá»‡n lÆ°u vÃ o Ä‘Ä©a toÃ n bá»™ tin nháº¯n nÃ³ cÃ³ thá»ƒ chá»‰ Ä‘Æ°á»£c lÆ°u vÃ o Ä‘á»‡m mÃ  khÃ´ng lÆ°u vÃ o Ä‘Ä©a )

        experionTime: THá»i gian tá»“n táº¡i cá»§a má»™t message náº¿u nÃ³ chÆ°a Ä‘Æ°á»£c xá»­ lÃ­ 

        channel.assertQueue(queueName, { durable: false, exclusive: true }, ); : Tuá»± Ä‘á»™ng xÃ³a queue sau khi close service

        Má»™t channel producer chá»‰ cÃ³ thá»ƒ káº¿t ná»‘i má»™t exchange nhÆ°ng 1 queue cÃ³ thá»ƒ káº¿t ná»‘i nhiá»u exchange

        ðŸ’ Fair dispatch: Má»™t Ä‘iá»ƒm vÃ´ cÃ¹ng quan trá»ng trong phÃ¢n phá»‘i message cho cÃ¡c consumer lÃ  nÃ³ chá»‰ phÃ¢n phá»‘i giá»‘ng dáº¡ng cháº³n láº½ tá»©c lÃ  consumer1 nháº­n message 1 consumer 2 nháº­n message 2 chá»© khÃ´ng dá»±a vÃ o má»©c Ä‘á»™ xá»­ lÃ­ lÃ¢u cá»§a consumer. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c prefect cÃ³ giÃ¡ trá»‹ 1. Äiá»u nÃ y yÃªu cáº§u RabbitMQ khÃ´ng gá»­i nhiá»u tin nháº¯n cho má»™t nhÃ¢n viÃªn cÃ¹ng má»™t lÃºc. Hay nÃ³i cÃ¡ch khÃ¡c khÃ´ng gá»­i tin nháº¯n má»›i cho má»™t nhÃ¢n viÃªn cho Ä‘áº¿n khi nÃ³ xá»­ lÃ½ vÃ  xÃ¡c nháº­n tin nháº¯n trÆ°á»›c Ä‘Ã³. Thay vÃ o Ä‘Ã³ nÃ³ sáº½ gá»­i nÃ³ cho nhÃ¢n viÃªn tiáº¿p theo khÃ´ng cÃ²n báº­n.

             => channel.prefetch(1);

        

